# 阿岳TTS阅读器 v1.2 使用说明
## 一、程序简介
本程序基于 Piper TTS 引擎开发;
项目地址：[Github](https://github.com/OHF-Voice/piper1-gpl/)

音频模型地址：[hugging face](https://huggingface.co/rhasspy/piper-voices/tree/main)

支持读取 JSON 格式文本文件并进行语音合成朗读，具备语速/音量/噪声尺度等多参数可调、断点续读、实时插入朗读内容等功能，适配 Windows 系统，无需安装 Python 环境即可运行。

## 二、部署要求
### 1. 系统环境
- 操作系统：Windows 7/10/11（64位/32位，推荐64位）
- 必装依赖：espeak-ng.msi

### 2. 文件结构（必须按此放置）
```
├── TTS阅读器.exe          # 主程序文件
├── 文件处理脚本.exe          # 文本处理文件
├── piper-voices/          # 语音模型文件夹（必须和exe同目录）
│   └── xxx.onnx           # Piper TTS 模型文件（支持多个.onnx模型）
└── 待朗读文本.json        # 自定义的朗读文本文件（格式见下文）
```
⚠️ 关键注意：
- `piper-voices` 文件夹名称不可修改，且必须与 `TTS阅读器.exe` 放在同一目录；
- 程序路径不可包含中文/特殊字符（如 `D:\TTS阅读器\` 可行，`D:\我的软件\TTS\` 会报错）。

## 三、快速使用步骤
### 步骤1：准备工作
1. 将程序压缩包解压到**纯英文路径**下（如 `D:\TTSReader\`）；
2. 将 Piper TTS 模型文件（.onnx 格式）放入 `piper-voices` 文件夹；
3. 确保目标电脑已安装 VC++ 运行库（见第二章）。

### 步骤2：准备朗读文本（JSON格式）
程序仅支持读取 JSON 格式文本，要求每个条目包含 `text` 字段，示例格式如下（可新建文本文档，改后缀为 `.json`）：
```json
[
    {"text": "第一句要朗读的内容"},
    {"text": "第二句要朗读的内容"},
    {"text": "第三句要朗读的内容"}
]
```

### 步骤3：运行程序
1. 双击 `TTS阅读器.exe` 启动程序，界面如下：
   - 基础设置：选择JSON文件、选择语音模型
   - 语音参数调节：调整句间暂停、语速、音量等
   - 播放控制：设置起始句、插入内容、开始/停止朗读
   - 日志区域：查看运行状态和报错信息

### 步骤4：开始朗读
1. 点击「基础设置」→「选择」按钮，选中准备好的 JSON 文本文件；
2. 在「语音模型」下拉框中选择已放入 `piper-voices` 文件夹的模型（如 `zh-CN-liaoning-medium.onnx`）；
3. （可选）调节语音参数（参考第四章）；
4. （可选）在「起始句」输入框填写要从第几句开始朗读（默认从第1句）；
5. 点击「开始朗读」按钮，程序将按顺序朗读文本，日志区域会显示当前朗读内容；
6. 如需暂停，点击「停止朗读」按钮（程序会自动保存当前朗读进度）。

## 四、功能详解
### 1. 基础设置模块
| 功能项       | 说明                                                                 |
|--------------|----------------------------------------------------------------------|
| JSON文件选择 | 点击「选择」按钮，选中符合格式的JSON文本文件，选中后显示文件名         |
| 语音模型选择 | 下拉框自动加载 `piper-voices` 文件夹中的所有.onnx模型，需选择后才能朗读 |

### 2. 语音参数调节模块
| 参数项       | 取值范围       | 说明                                                                 |
|--------------|----------------|----------------------------------------------------------------------|
| 句间暂停(ms) | 0 - 1500       | 每句朗读完成后的停顿时间，单位毫秒（默认300ms）                     |
| 语速         | 0.5 - 2.0      | 数值越小语速越快，数值越大语速越慢（默认0.90）                       |
| 音量         | 0.1 - 2.0      | 合成语音的音量大小，1.0为默认音量，2.0为双倍音量                     |
| 噪声尺度     | 0.0 - 1.0      | 控制语音合成的随机性，数值越大语音变化越明显（默认0.667）             |
| 说话变异     | 0.0 - 1.0      | 控制语音特征的变异程度，影响音色多样性（默认0.800）                   |
| 音频归一化   | 勾选/取消      | 推荐开启，自动校准音频音量，避免音量忽大忽小                         |

### 3. 播放控制模块
| 功能项       | 说明                                                                 |
|--------------|----------------------------------------------------------------------|
| 起始句       | 输入数字，朗读时从指定句子开始（如输入5，从第5句开始朗读）           |
| 插入内容     | 朗读过程中，在输入框填写文本并点击「插入」，文本会插入到下一句朗读     |
| 开始朗读     | 启动朗读任务，点击后按钮禁用，需停止后才能重新点击                   |
| 停止朗读     | 终止当前朗读任务，自动保存当前进度，下次启动可选择续读               |
| 进度显示     | 实时显示「已朗读数/总句子数」，以及当前朗读到第几句                   |

### 4. 日志区域
- 显示程序运行状态（如模型加载成功、JSON文件加载成功）；
- 显示错误信息（如模型缺失、JSON格式错误）；
- 显示朗读进度（如「[朗读] 第一句要朗读的内容」）。

## 五、断点续读功能
程序会自动在 exe 同目录生成 `playback_state.json` 文件，记录最后一次朗读的 JSON 文件路径和进度：
1. 下次启动程序时，会弹窗提示「检测到上次进度，是否续读」；
2. 选择「是」：自动加载上次的 JSON 文件，并从上次中断的句子开始；
3. 选择「否」：清空进度，重新选择文件/模型。

## 六、常见问题解决
### 1. 程序启动/点击「开始朗读」闪退
- 原因：缺少 VC++ 运行库或 PortAudio 音频依赖；
- 解决：安装第二章的 VC++ 运行库，确保程序路径无中文。

### 2. 提示「piper-voices 文件夹不存在」
- 原因：`piper-voices` 文件夹未放在 exe 同目录，或文件夹名称错误；
- 解决：检查文件夹名称是否为 `piper-voices`，并确保与 exe 同目录。

### 3. 语音模型下拉框为空
- 原因：`piper-voices` 文件夹中无 .onnx 模型文件，或模型文件损坏；
- 解决：确认模型文件格式为 .onnx，且放入 `piper-voices` 文件夹。

### 4. 提示「JSON 文件加载失败」
- 原因：JSON 文件格式错误（如缺少逗号、引号，或无 `text` 字段）；
- 解决：参考第三章的 JSON 示例格式，检查文件语法。

### 5. 朗读无声音
- 原因：音频设备禁用、音量静音，或参数设置异常；
- 解决：
  1. 检查电脑音箱/耳机是否正常，音量是否开启；
  2. 将「音量」参数调至 1.0 以上；
  3. 确保「音频归一化」已勾选。

## 七、注意事项
1. 临时文件：程序朗读时会生成临时 .wav 文件，朗读完成后自动删除；
2. 日志文件：若程序报错，exe 同目录会生成 `error_detail.log`，可查看具体错误原因；
3. 性能：低配置电脑可能出现朗读卡顿，可降低「噪声尺度」「说话变异」参数；
4. 模型兼容性：仅支持 Piper 官方的 .onnx 格式模型，其他格式模型无法加载。